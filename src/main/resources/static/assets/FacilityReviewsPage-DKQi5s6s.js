import{u as e,r as a,al as r,R as l,j as s,h as t,Y as i,M as n,a8 as c,a5 as d,a as m}from"./react-vendor-D482bdOD.js";import{S as o,r as h}from"./StarRating-NgqKDVDd.js";import{B as p}from"./core-ui-B951Z2Bq.js";import"./facility-pages-CBy5qHE4.js";import{C as u,b as y,c as x,a as g}from"./chat-pages-eKQuMn9L.js";import{L as b,E as N}from"./board-pages-CaaiBp8P.js";import{R as f}from"./ReviewCard-CBIc0RlZ.js";import{A as v,m as w}from"./animation-lib-DO1H1ffU.js";import"./vendor-lkuvNL7c.js";import"./state-management-DFZwgI-2.js";import"./style-utils-DeQRAeyh.js";import"./theme-layout-BH1OkAcf.js";import"./http-client-9JY-woyA.js";const j=()=>{const{facilityId:j}=e(),[C,R]=a.useState("latest"),[k,I]=a.useState(null),[z,A]=a.useState(!1),{data:D,isLoading:M,error:$,refetch:q}=r({queryKey:["facility-reviews",j],queryFn:()=>h.getFacilityReviews(parseInt(j)),enabled:!!j,staleTime:12e4}),B=()=>{window.location.href=`/reviews/create?facilityId=${j}`},F=l.useMemo(()=>{if(!D||0===D.length)return null;const e=D.length,a=D.reduce((e,a)=>e+a.overallRating,0)/e,r=[5,4,3,2,1].map(a=>{const r=D.filter(e=>Math.floor(e.overallRating)===a).length;return{rating:a,count:r,percentage:r/e*100}});return{totalReviews:e,averageRating:a,ratingDistribution:r}},[D]),L=l.useMemo(()=>{if(!D)return[];let e=D;return null!==k&&(e=e.filter(e=>Math.floor(e.overallRating)===k)),e.sort((e,a)=>{switch(C){case"rating":return a.overallRating-e.overallRating;case"helpful":return(a.helpfulCount||0)-(e.helpfulCount||0);default:return new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime()}})},[D,C,k]);return M?s.jsx("div",{className:"min-h-screen bg-elderberry-25 py-8",children:s.jsx("div",{className:"max-w-6xl mx-auto px-4",children:s.jsx(b,{})})}):$?s.jsx("div",{className:"min-h-screen bg-elderberry-25 py-8",children:s.jsx("div",{className:"max-w-6xl mx-auto px-4",children:s.jsx(N,{message:"시설 리뷰를 불러오는 중 오류가 발생했습니다.",onRetry:()=>q()})})}):s.jsx("div",{className:"min-h-screen bg-elderberry-25 py-8",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-elderberry-900 mb-2",children:"시설 리뷰"}),s.jsx("p",{className:"text-elderberry-600",children:"실제 이용자들의 솔직한 시설 후기를 확인해보세요"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:F&&s.jsxs(u,{className:"sticky top-6",children:[s.jsx(y,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(t,{className:"w-5 h-5 text-elderberry-600"}),"리뷰 통계"]})}),s.jsx(g,{children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-4xl font-bold text-elderberry-900 mb-2",children:F.averageRating.toFixed(1)}),s.jsx(o,{value:F.averageRating,readonly:!0,size:"sm"}),s.jsxs("div",{className:"text-sm text-elderberry-600 mt-2",children:["총 ",F.totalReviews,"개 리뷰"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-elderberry-900",children:"평점 분포"}),F.ratingDistribution.map(({rating:e,count:a,percentage:r})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 w-12",children:[s.jsx("span",{className:"text-sm",children:e}),s.jsx(i,{className:"w-3 h-3 text-yellow-400 fill-current"})]}),s.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-elderberry-500 h-2 rounded-full transition-all duration-300",style:{width:`${r}%`}})}),s.jsx("span",{className:"text-sm text-elderberry-600 w-8 text-right",children:a})]},e))]}),s.jsxs(p,{variant:"primary",onClick:B,className:"w-full flex items-center justify-center gap-2",children:[s.jsx(n,{className:"w-4 h-4"}),"리뷰 작성하기"]})]})})]})}),s.jsxs("div",{className:"lg:col-span-3",children:[s.jsx(u,{className:"mb-6",children:s.jsxs(g,{className:"p-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(p,{variant:"outline",size:"sm",onClick:()=>A(!z),className:"flex items-center gap-2",children:[s.jsx(c,{className:"w-4 h-4"}),"필터",s.jsx(d,{className:"w-4 h-4 transition-transform "+(z?"rotate-180":"")})]}),s.jsx("div",{children:s.jsxs("select",{value:C,onChange:e=>R(e.target.value),className:"px-3 py-2 border border-elderberry-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-elderberry-500",children:[s.jsx("option",{value:"latest",children:"최신순"}),s.jsx("option",{value:"rating",children:"평점 높은순"}),s.jsx("option",{value:"helpful",children:"도움순"})]})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(p,{variant:"outline",size:"sm",onClick:()=>q(),className:"flex items-center gap-2",children:[s.jsx(m,{className:"w-4 h-4"}),"새로고침"]}),D&&s.jsxs("span",{className:"text-sm text-elderberry-600",children:[L.length,"개 리뷰"]})]})]}),s.jsx(v,{children:z&&s.jsx(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-elderberry-200",children:s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-elderberry-700 mb-1",children:"평점 필터"}),s.jsxs("select",{value:k||"",onChange:e=>I(e.target.value?parseInt(e.target.value):null),className:"px-3 py-2 border border-elderberry-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-elderberry-500",children:[s.jsx("option",{value:"",children:"전체"}),s.jsx("option",{value:"5",children:"5점만"}),s.jsx("option",{value:"4",children:"4점만"}),s.jsx("option",{value:"3",children:"3점만"}),s.jsx("option",{value:"2",children:"2점만"}),s.jsx("option",{value:"1",children:"1점만"})]})]})})})})]})}),L.length>0?s.jsx("div",{className:"space-y-4",children:L.map((e,a)=>s.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},children:s.jsx(f,{review:e,showFacilityInfo:!1,showActions:!1})},e.id))}):s.jsx(u,{className:"text-center py-12",children:s.jsxs(g,{children:[s.jsx(n,{className:"w-12 h-12 text-elderberry-300 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-elderberry-900 mb-2",children:k?`${k}점 리뷰가 없습니다`:"작성된 리뷰가 없습니다"}),s.jsx("p",{className:"text-elderberry-600 mb-6",children:k?"다른 평점의 리뷰를 확인해보세요.":"이 시설에 대한 첫 번째 리뷰를 작성해보세요."}),s.jsx(p,{variant:"primary",onClick:k?()=>I(null):B,children:k?"전체 리뷰 보기":"첫 리뷰 작성하기"})]})})]})]})]})})};export{j as default};

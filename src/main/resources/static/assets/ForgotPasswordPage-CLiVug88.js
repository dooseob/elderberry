var e=(e,a,s)=>new Promise((r,l)=>{var t=e=>{try{n(s.next(e))}catch(a){l(a)}},i=e=>{try{n(s.throw(e))}catch(a){l(a)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(t,i);n((s=s.apply(e,a)).next())});import{k as a,u as s,aF as r,b6 as l,j as t,as as i,a as n,G as o,ax as c,aQ as d,b as m,p as u,Q as x,C as h,ah as v,l as f}from"./react-vendor-3vt79Rze.js";import{t as p,o as g,s as j}from"./utils-Cch7O-NE.js";import{A as w,E as y,I as b,P as N,a as C}from"./index-Dj62aP8m.js";import{u as P,B as k}from"./board-pages-ntRfRgml.js";import"./vendor-BkdLQwpK.js";import"./state-management-DvPYDz8O.js";import"./facility-pages-MQeZa_cx.js";import"./ui-libs-CPaKlxPe.js";import"./chat-pages-B4r41bQP.js";const S=g({email:j().min(1,"이메일을 입력해주세요").email("올바른 이메일 형식이 아닙니다")}),T=g({verificationCode:j().min(6,"인증번호는 6자리입니다").max(6,"인증번호는 6자리입니다"),newPassword:j().min(8,"비밀번호는 최소 8자 이상이어야 합니다").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/,"비밀번호는 대소문자, 숫자, 특수문자를 포함해야 합니다"),confirmPassword:j().min(1,"비밀번호 확인을 입력해주세요")}).refine(e=>e.newPassword===e.confirmPassword,{message:"비밀번호가 일치하지 않습니다",path:["confirmPassword"]}),E=S.merge(T),I=[{id:1,title:"이메일 확인",description:"가입한 이메일 주소를 입력해주세요",icon:c},{id:2,title:"비밀번호 재설정",description:"인증번호 확인 후 새 비밀번호를 설정하세요",icon:d}],z=()=>{var g,j,S,T;const z=a(),[O]=s(),{isReducedMotion:q}=P(),J=O.get("token"),L=O.get("email"),[R,V]=r.useState(J?2:1),[A,F]=r.useState(!1),[M,Q]=r.useState(null),[$,B]=r.useState(null),[G,H]=r.useState(!1),[Z,D]=r.useState(0),[K,U]=r.useState(null),W=r.useRef(),{register:X,handleSubmit:Y,watch:_,setValue:ee,trigger:ae,formState:{errors:se,isValid:re}}=l({resolver:p(E),defaultValues:{email:L||"",verificationCode:"",newPassword:"",confirmPassword:""},mode:"onChange"}),le=_("email"),te=_("verificationCode"),ie=_("newPassword"),ne=_("confirmPassword");r.useEffect(()=>{J&&L&&oe(J,L)},[J,L]),r.useEffect(()=>(Z>0&&(W.current=setInterval(()=>{D(e=>e<=1?(W.current&&clearInterval(W.current),0):e-1)},1e3)),()=>{W.current&&clearInterval(W.current)}),[Z]),r.useEffect(()=>{if(M){const e=setTimeout(()=>{Q(null)},5e3);return()=>clearTimeout(e)}},[M]);const oe=(a,s)=>e(null,null,function*(){try{F(!0);const e=yield fetch("/api/auth/validate-reset-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,email:s})}),r=yield e.json();e.ok&&r.valid?(U(!0),ee("email",s)):(U(!1),Q("유효하지 않거나 만료된 재설정 링크입니다."),V(1))}catch(e){U(!1),Q("링크 검증 중 오류가 발생했습니다."),V(1)}finally{F(!1)}}),ce=a=>e(null,null,function*(){try{F(!0),Q(null);const e=yield fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})}),s=yield e.json();if(!e.ok)throw new Error(s.message||"이메일 전송에 실패했습니다.");H(!0),B("비밀번호 재설정 링크가 이메일로 전송되었습니다."),V(2)}catch(e){Q(e instanceof Error?e.message:"이메일 전송에 실패했습니다.")}finally{F(!1)}}),de=Math.round(R/I.length*100);return $&&2===R&&!M?t.jsx(w,{title:"비밀번호 변경 완료",subtitle:"비밀번호가 성공적으로 변경되었습니다",showHomeLink:!0,showThemeToggle:!0,testId:"password-reset-success",children:t.jsxs("div",{className:"text-center space-y-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-[var(--linear-color-success)] rounded-full flex items-center justify-center",children:t.jsx(i,{className:"w-8 h-8 text-white"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-xl font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:"변경 완료!"}),t.jsxs("p",{className:"text-[var(--linear-color-text-secondary)]",children:["비밀번호가 성공적으로 변경되었습니다.",t.jsx("br",{}),"잠시 후 로그인 페이지로 이동됩니다."]})]}),t.jsx("div",{className:"w-8 h-8 mx-auto animate-spin rounded-full border-2 border-[var(--linear-color-accent)] border-t-transparent"}),t.jsx(k,{variant:"primary",size:"lg",asChild:!0,className:"w-full",children:t.jsxs(n,{to:"/login",children:[t.jsx(o,{className:"w-4 h-4"}),"지금 로그인하기"]})})]})}):t.jsx(w,{title:"비밀번호 찾기",subtitle:"등록된 이메일로 비밀번호를 재설정하세요",backLink:"/login",showThemeToggle:!0,testId:"forgot-password-page",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[t.jsxs("span",{children:["단계 ",R," / ",I.length]}),t.jsxs("span",{children:[de,"% 완료"]})]}),t.jsx("div",{className:"w-full h-2 bg-[var(--linear-color-border-subtle)] rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-[var(--linear-color-accent)] transition-all duration-300 ease-out",style:{width:`${de}%`}})}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-[var(--linear-color-accent)] rounded-full flex items-center justify-center",children:r.createElement(I[R-1].icon,{className:"w-6 h-6 text-white"})}),t.jsx("h2",{className:"text-lg font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:I[R-1].title}),t.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:I[R-1].description})]})]}),1===R&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(y,{label:"이메일 주소",placeholder:"가입할 때 사용한 이메일을 입력하세요",value:le,onChange:e=>ee("email",e.target.value),errorText:null==(g=se.email)?void 0:g.message,autoComplete:"email",autoFocus:!0,required:!0}),M&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[t.jsx(m,{className:"w-4 h-4 flex-shrink-0"}),M]}),$&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-success-bg)] text-[var(--linear-color-success)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[t.jsx(i,{className:"w-4 h-4 flex-shrink-0"}),$]}),t.jsxs(k,{type:"button",variant:"primary",size:"lg",onClick:()=>e(null,null,function*(){(yield ae(["email"]))&&(yield ce(le))}),loading:A,disabled:!le||!!se.email||A,className:"w-full",children:[t.jsx(u,{className:"w-4 h-4"}),"재설정 링크 받기"]})]}),2===R&&t.jsxs("form",{onSubmit:Y(a=>e(null,null,function*(){yield(a=>e(null,null,function*(){try{F(!0),Q(null);const e=yield fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,verificationCode:a.verificationCode,newPassword:a.newPassword,token:J})}),s=yield e.json();if(!e.ok)throw new Error(s.message||"비밀번호 재설정에 실패했습니다.");B("비밀번호가 성공적으로 변경되었습니다."),setTimeout(()=>{z("/login",{state:{message:"비밀번호가 변경되었습니다. 새 비밀번호로 로그인해주세요.",email:a.email}})},3e3)}catch(e){Q(e instanceof Error?e.message:"비밀번호 재설정에 실패했습니다.")}finally{F(!1)}}))(a)})),className:"space-y-6",children:[t.jsx("div",{className:"p-4 bg-[var(--linear-color-surface-elevated)] rounded-[var(--linear-radius-medium)] border border-[var(--linear-color-border-subtle)]",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(c,{className:"w-5 h-5 text-[var(--linear-color-accent)]"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:le}),t.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)]",children:"위 이메일로 인증번호가 전송되었습니다"})]}),0===Z&&t.jsxs(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>e(null,null,function*(){Z>0||(yield ce(le),D(60))}),disabled:A,children:[t.jsx(x,{className:"w-3 h-3"}),"재발송"]}),Z>0&&t.jsxs("div",{className:"flex items-center gap-1 text-xs text-[var(--linear-color-text-tertiary)]",children:[t.jsx(h,{className:"w-3 h-3"}),Z,"초"]})]})}),t.jsx(b,{label:"인증번호",placeholder:"이메일로 받은 6자리 인증번호",value:te,onChange:e=>ee("verificationCode",e.target.value),errorText:null==(j=se.verificationCode)?void 0:j.message,startIcon:t.jsx(v,{className:"w-4 h-4"}),maxLength:6,autoComplete:"one-time-code",required:!0}),t.jsx(N,{label:"새 비밀번호",placeholder:"새로운 비밀번호를 입력하세요",value:ie,onChange:e=>ee("newPassword",e.target.value),errorText:null==(S=se.newPassword)?void 0:S.message,showStrengthIndicator:!0,showRequirements:!0,autoComplete:"new-password",required:!0}),t.jsx(C,{label:"비밀번호 확인",placeholder:"새 비밀번호를 다시 입력하세요",originalPassword:ie,value:ne,onChange:e=>ee("confirmPassword",e.target.value),errorText:null==(T=se.confirmPassword)?void 0:T.message,autoComplete:"new-password",required:!0}),M&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[t.jsx(m,{className:"w-4 h-4 flex-shrink-0"}),M]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(k,{type:"button",variant:"outline",size:"lg",onClick:()=>V(1),className:"flex-1",children:[t.jsx(f,{className:"w-4 h-4"}),"이전"]}),t.jsxs(k,{type:"submit",variant:"primary",size:"lg",loading:A,disabled:!te||!ie||!ne||!!se.verificationCode||!!se.newPassword||!!se.confirmPassword||A,className:"flex-1",children:[t.jsx(d,{className:"w-4 h-4"}),"비밀번호 변경"]})]})]}),t.jsx("div",{className:"text-center pt-4 border-t border-[var(--linear-color-border-subtle)]",children:t.jsxs("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:["비밀번호가 기억나셨나요?"," ",t.jsxs(n,{to:"/login",className:"text-[var(--linear-color-accent)] hover:underline font-[var(--linear-font-weight-medium)] inline-flex items-center gap-1",children:[t.jsx(o,{className:"w-3 h-3"}),"로그인하기"]})]})})]})})};export{z as ForgotPasswordPage,z as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auth-DIMvkptR.js","assets/utils-DauvGrRn.js","assets/vendor-C4_sagfc.js","assets/react-vendor-Lz2W1ZkW.js","assets/state-management-DAchmhq-.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(r,t,o)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,a=(e,r)=>{for(var t in r||(r={}))n.call(r,t)&&s(e,t,r[t]);if(o)for(var t of o(r))l.call(r,t)&&s(e,t,r[t]);return e},i=(e,r,t)=>new Promise((o,n)=>{var l=e=>{try{a(t.next(e))}catch(r){n(r)}},s=e=>{try{a(t.throw(e))}catch(r){n(r)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,s);a((t=t.apply(e,r)).next())});import{_ as c}from"./index-DbGkYzdj.js";import{s as u,p as d,i as h}from"./state-management-DAchmhq-.js";import{c as y}from"./react-vendor-Lz2W1ZkW.js";const f={user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null},g=()=>{try{return localStorage.getItem("accessToken")}catch(e){return null}},m=()=>{try{return localStorage.getItem("refreshToken")}catch(e){return null}},T=(e,r)=>{try{localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",r)}catch(t){}},p=()=>{try{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}catch(e){}},k=new Set,E=y()(u(d(h((e,o)=>{return n=a({},f),l={user:(()=>{try{const e=localStorage.getItem("user");return e?JSON.parse(e):null}catch(e){return null}})(),accessToken:g(),refreshToken:m(),isAuthenticated:!!g(),login:r=>i(null,null,function*(){try{e(e=>{e.isLoading=!0,e.error=null});const{login:t}=yield c(()=>i(null,null,function*(){const{login:e}=yield import("./auth-DIMvkptR.js");return{login:e}}),__vite__mapDeps([0,1,2,3,4])),n=yield t(r),{accessToken:l,refreshToken:s,memberInfo:a}=n;T(l,s),localStorage.setItem("user",JSON.stringify(a)),e(e=>{e.user=a,e.accessToken=l,e.refreshToken=s,e.isAuthenticated=!0,e.isLoading=!1,e.error=null}),o().emit({type:"LOGIN_SUCCESS",payload:{user:a}})}catch(t){const r=t instanceof Error?t.message:"로그인에 실패했습니다.";throw e(e=>{e.isLoading=!1,e.error=r}),o().emit({type:"LOGIN_FAILURE",payload:{error:r}}),t}}),register:r=>i(null,null,function*(){try{e(e=>{e.isLoading=!0,e.error=null});const{register:t}=yield c(()=>i(null,null,function*(){const{register:e}=yield import("./auth-DIMvkptR.js");return{register:e}}),__vite__mapDeps([0,1,2,3,4])),o=yield t(r),{accessToken:n,refreshToken:l,memberInfo:s}=o;T(n,l),localStorage.setItem("user",JSON.stringify(s)),e(e=>{e.user=s,e.accessToken=n,e.refreshToken=l,e.isAuthenticated=!0,e.isLoading=!1,e.error=null})}catch(t){const r=t instanceof Error?t.message:"회원가입에 실패했습니다.";throw e(e=>{e.isLoading=!1,e.error=r}),t}}),logout:()=>i(null,null,function*(){try{const{logout:e}=yield c(()=>i(null,null,function*(){const{logout:e}=yield import("./auth-DIMvkptR.js");return{logout:e}}),__vite__mapDeps([0,1,2,3,4]));yield e()}catch(r){}finally{p(),localStorage.removeItem("user"),e(e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1,e.isLoading=!1,e.error=null}),o().emit({type:"LOGOUT",payload:{}})}}),refreshTokens:()=>i(null,null,function*(){try{if(!o().refreshToken)throw new Error("리프레시 토큰이 없습니다.");const{validateToken:r}=yield c(()=>i(null,null,function*(){const{validateToken:e}=yield import("./auth-DIMvkptR.js");return{validateToken:e}}),__vite__mapDeps([0,1,2,3,4]));if(!(yield r()))throw new Error("토큰 갱신에 실패했습니다.");const t=g(),n=m();t&&n&&(e(e=>{e.accessToken=t,e.refreshToken=n,e.isAuthenticated=!0,e.error=null}),o().emit({type:"TOKEN_REFRESH",payload:{accessToken:t}}))}catch(r){throw o().logout(),r}}),updateProfile:r=>i(null,null,function*(){try{e(e=>{e.isLoading=!0,e.error=null});const t=yield fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o().accessToken}`},body:JSON.stringify(r)});if(!t.ok)throw new Error("프로필 업데이트에 실패했습니다.");const n=yield t.json();localStorage.setItem("user",JSON.stringify(n)),e(e=>{e.user=n,e.isLoading=!1,e.error=null}),o().emit({type:"PROFILE_UPDATE",payload:{user:n}})}catch(t){const r=t instanceof Error?t.message:"프로필 업데이트에 실패했습니다.";throw e(e=>{e.isLoading=!1,e.error=r}),t}}),changePassword:r=>i(null,null,function*(){try{if(e(e=>{e.isLoading=!0,e.error=null}),!(yield fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o().accessToken}`},body:JSON.stringify(r)})).ok)throw new Error("비밀번호 변경에 실패했습니다.");e(e=>{e.isLoading=!1,e.error=null})}catch(t){const r=t instanceof Error?t.message:"비밀번호 변경에 실패했습니다.";throw e(e=>{e.isLoading=!1,e.error=r}),t}}),refreshUser:()=>i(null,null,function*(){try{e(e=>{e.isLoading=!0});const r=yield fetch("/api/auth/profile",{headers:{Authorization:`Bearer ${o().accessToken}`}});if(!r.ok)throw new Error("사용자 정보 조회에 실패했습니다.");const t=yield r.json();localStorage.setItem("user",JSON.stringify(t)),e(e=>{e.user=t,e.isLoading=!1,e.error=null})}catch(r){const t=r instanceof Error?r.message:"사용자 정보 조회에 실패했습니다.";throw e(e=>{e.isLoading=!1,e.error=t}),r}}),setTokens:(r,t)=>{T(r,t),e(e=>{e.accessToken=r,e.refreshToken=t,e.isAuthenticated=!0})},clearTokens:()=>{p(),localStorage.removeItem("user"),e(e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1})},validateToken:()=>i(null,null,function*(){try{if(!o().accessToken)return!1;const{validateToken:e}=yield c(()=>i(null,null,function*(){const{validateToken:e}=yield import("./auth-DIMvkptR.js");return{validateToken:e}}),__vite__mapDeps([0,1,2,3,4]));return yield e()}catch(e){return!1}}),setLoading:r=>{e(e=>{e.isLoading=r})},setError:r=>{e(e=>{e.error=r})},clearError:()=>{e(e=>{e.error=null})},reset:()=>{p(),localStorage.removeItem("user"),e(()=>a({},f))},emit:e=>{k.forEach(r=>{try{r(e)}catch(t){}})},subscribe:e=>(k.add(e),()=>{k.delete(e)})},r(n,t(l));var n,l}),{name:"elderberry-auth",partialize:e=>({isAuthenticated:e.isAuthenticated})})));export{E as u};

var e=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(r,a,l)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l,s=(e,r)=>{for(var a in r||(r={}))t.call(r,a)&&n(e,a,r[a]);if(l)for(var a of l(r))i.call(r,a)&&n(e,a,r[a]);return e},o=(e,l)=>r(e,a(l)),c=(e,r,a)=>new Promise((l,t)=>{var i=e=>{try{s(a.next(e))}catch(r){t(r)}},n=e=>{try{s(a.throw(e))}catch(r){t(r)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,n);s((a=a.apply(e,r)).next())});import{R as d,j as m,Y as h,L as u,q as v,au as p,w as f,ae as x,V as b,J as g,l as N,aY as w,d as y,m as C,A as k,b as j,H as T,ac as $,_ as S,b5 as I,ag as V}from"./react-vendor-DgfdclPJ.js";import{t as q,o as E,s as A,e as O,r as P,b as L}from"./schema-validation-4yuSMpZU.js";import{A as R,E as D,P as M,a as z}from"./index-CzZxE2f6.js";import{b as B,I as G,B as K}from"./core-ui-DRCkfLHi.js";import{e as F}from"./board-pages-D2pf0vfR.js";import{u as Y}from"./store-Co68ojLD.js";import{a as _}from"./theme-layout-DBJeLQKe.js";import"./vendor-DKWjmJEO.js";import"./state-management-DFZwgI-2.js";import"./form-libs-B_aaymRE.js";import"./animation-lib-Bccw-fVq.js";import"./chat-pages-CpAaoQ7v.js";import"./style-utils-DeQRAeyh.js";import"./http-client-9JY-woyA.js";const J={SKT:/^010-[2-9]\d{3}-\d{4}$/,KT:/^010-[0-1]\d{3}-\d{4}$/,LG:/^010-(3|6|7|8|9)\d{3}-\d{4}$/,GENERAL:/^010-\d{4}-\d{4}$/},U=e=>{var r=e,{enableAutoFormat:a=!0,showVerificationButton:n=!1,onSendVerification:f,isSendingVerification:x=!1,verificationSent:b=!1,resendCooldown:g=60,showCarrier:N=!1,additionalValidation:w,value:y,onChange:C,className:k}=r,j=((e,r)=>{var a={};for(var n in e)t.call(e,n)&&r.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&l)for(var n of l(e))r.indexOf(n)<0&&i.call(e,n)&&(a[n]=e[n]);return a})(r,["enableAutoFormat","showVerificationButton","onSendVerification","isSendingVerification","verificationSent","resendCooldown","showCarrier","additionalValidation","value","onChange","className"]);const[T,$]=d.useState(y||""),[S,I]=d.useState(null),[V,q]=d.useState(0),E=d.useRef(),A=d.useCallback(e=>{if(!a)return e;const r=e.replace(/\D/g,"");return r.length<=3?r:r.length<=7?`${r.slice(0,3)}-${r.slice(3)}`:r.length<=11?`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7)}`:`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7,11)}`},[a]),O=d.useCallback(e=>{const r=e.replace(/\D/g,"");if(r.length<11)return null;const a=A(r);return J.SKT.test(a)?"SKT":J.KT.test(a)?"KT":J.LG.test(a)?"LG U+":J.GENERAL.test(a)?"알 수 없음":null},[A]),P=d.useCallback(e=>{if(!e)return null;const r=B(e);if(r)return r;if(w){const r=w(e);if(r)return r}return null},[w]);d.useEffect(()=>()=>{E.current&&clearInterval(E.current)},[]);const L=void 0!==y?y.toString():T,R=!P(L)&&L.length>=13;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx(G,o(s({},j),{type:"tel",value:void 0!==y?y:T,onChange:e=>{const r=e.target.value,a=A(r),l=O(a);$(a),I(l);const t=o(s({},e),{target:o(s({},e.target),{value:a})});null==C||C(t)},validate:P,startIcon:m.jsx(h,{className:"w-4 h-4"}),autoComplete:"tel",placeholder:"010-1234-5678",maxLength:13,className:F(n&&"flex-1",k)})),n&&m.jsx(K,{type:"button",variant:b?"success":"secondary",size:"default",onClick:()=>c(null,null,function*(){if(!f||x||V>0)return;const e=void 0!==y?y.toString():T;if(!P(e))try{yield f(e),q(g),E.current=setInterval(()=>{q(e=>e<=1?(E.current&&clearInterval(E.current),0):e-1)},1e3)}catch(r){}}),disabled:!R||x||V>0,className:"min-w-[100px] flex-shrink-0","aria-label":"인증번호 발송",children:x?m.jsxs(m.Fragment,{children:[m.jsx(u,{className:"w-4 h-4 animate-spin"}),m.jsx("span",{className:"ml-2",children:"발송중"})]}):b&&0===V?m.jsxs(m.Fragment,{children:[m.jsx(v,{className:"w-4 h-4"}),m.jsx("span",{className:"ml-2",children:"재발송"})]}):V>0?m.jsx("span",{className:"text-sm font-mono",children:(D=V,`${Math.floor(D/60)}:${(D%60).toString().padStart(2,"0")}`)}):m.jsxs(m.Fragment,{children:[m.jsx(v,{className:"w-4 h-4"}),m.jsx("span",{className:"ml-2",children:"인증"})]})})]}),(N||b)&&L&&m.jsxs("div",{className:"flex items-center justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[N&&S&&m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(h,{className:"w-3 h-3"}),S]}),b&&m.jsxs("span",{className:"flex items-center gap-1 text-[var(--linear-color-success)]",children:[m.jsx(p,{className:"w-3 h-3"}),"인증번호가 발송되었습니다"]})]})]});var D},H={base:["w-5 h-5 rounded-[var(--linear-radius-small)]","border-2 border-[var(--linear-color-border-default)]","bg-[var(--linear-color-surface-input)]","transition-all duration-[var(--linear-transition-fast)]","flex items-center justify-center cursor-pointer","focus:outline-none focus:ring-2 focus:ring-[var(--linear-color-accent)] focus:ring-opacity-20","hover:border-[var(--linear-color-accent)]"],checked:["bg-[var(--linear-color-accent)] border-[var(--linear-color-accent)]","text-[var(--linear-color-text-on-accent)]"],disabled:["opacity-50 cursor-not-allowed"]},W=({checked:e,onChange:r,disabled:a=!1,id:l,"aria-label":t})=>m.jsx("div",{role:"checkbox",tabIndex:a?-1:0,"aria-checked":e,"aria-label":t,id:l,className:F(H.base,e&&H.checked,a&&H.disabled),onClick:()=>!a&&r(!e),onKeyDown:l=>{a||" "!==l.key&&"Enter"!==l.key||(l.preventDefault(),r(!e))},children:e&&m.jsx(p,{className:"w-3 h-3",strokeWidth:3})}),Z=({terms:e,values:r,onChange:a,error:l,showSelectAll:t=!0,onOpenTerms:i,compact:n=!1,className:c,testId:h="terms-checkbox"})=>{const u=d.useMemo(()=>e.filter(e=>e.required),[e]),v=d.useMemo(()=>e.filter(e=>!e.required),[e]),p=d.useMemo(()=>u.every(e=>!0===r[e.id]),[u,r]),N=d.useMemo(()=>v.every(e=>!0===r[e.id]),[v,r]),w=d.useMemo(()=>p&&N,[p,N]);d.useMemo(()=>Object.values(r).some(Boolean),[r]);const y=e=>e.icon?e.icon:e.title.includes("이용약관")||e.title.includes("서비스")?m.jsx(f,{className:"w-4 h-4"}):e.title.includes("개인정보")||e.title.includes("프라이버시")?m.jsx(x,{className:"w-4 h-4"}):e.title.includes("마케팅")||e.title.includes("광고")?m.jsx(b,{className:"w-4 h-4"}):m.jsx(f,{className:"w-4 h-4"});return m.jsxs("div",{className:F("space-y-4",c),"data-testid":h,children:[t&&m.jsx("div",{className:F("p-4 rounded-[var(--linear-radius-medium)]","bg-[var(--linear-color-surface-elevated)] border border-[var(--linear-color-border-subtle)]"),children:m.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[m.jsx(W,{id:"select-all-terms",checked:w,onChange:l=>{const t=s({},r);e.forEach(e=>{t[e.id]=l}),a(t)},"aria-label":"모든 약관에 동의"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("span",{className:"text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:"모든 약관에 동의합니다"}),!n&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)] mt-1",children:"선택 항목을 포함하여 모든 약관에 동의합니다"})]})]})}),m.jsx("div",{className:"space-y-3",children:e.map(e=>m.jsx("div",{className:F(n?"py-2":"p-3","rounded-[var(--linear-radius-medium)]","border border-[var(--linear-color-border-subtle)]","hover:bg-[var(--linear-color-surface-elevated)] transition-colors"),children:m.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[m.jsx(W,{id:`term-${e.id}`,checked:r[e.id]||!1,onChange:l=>((e,l)=>{a(o(s({},r),{[e]:l}))})(e.id,l),"aria-label":`${e.title} 동의`}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"text-[var(--linear-color-text-tertiary)] flex-shrink-0",children:y(e)}),m.jsxs("span",{className:F("text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]","flex items-center gap-1"),children:[e.title,e.required&&m.jsx("span",{className:"text-[var(--linear-color-error)] text-xs","aria-label":"필수",children:"*"})]}),(e.link||i)&&m.jsx("button",{type:"button",onClick:r=>((e,r)=>{r.preventDefault(),r.stopPropagation(),i?i(e.id):e.link&&window.open(e.link,"_blank","noopener,noreferrer")})(e,r),className:"text-[var(--linear-color-text-tertiary)] hover:text-[var(--linear-color-accent)] transition-colors ml-auto","aria-label":`${e.title} 내용 보기`,children:m.jsx(g,{className:"w-3 h-3"})})]}),!n&&e.description&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)] leading-relaxed",children:e.description})]})]})},e.id))}),l&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--linear-color-error)]",role:"alert",children:[m.jsx(g,{className:"w-4 h-4 flex-shrink-0"}),l]}),!n&&u.length>0&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-tertiary)] text-center",children:"* 표시된 항목은 서비스 이용을 위한 필수 동의 사항입니다"})]})},Q=[{id:"service",title:"엘더베리 서비스 이용약관",description:"엘더베리 플랫폼 서비스 이용에 대한 기본 약관입니다.",required:!0,link:"/terms/service",icon:m.jsx(f,{className:"w-4 h-4"})},{id:"privacy",title:"개인정보 수집 및 이용 동의",description:"서비스 제공을 위한 개인정보 처리에 대한 동의입니다.",required:!0,link:"/terms/privacy",icon:m.jsx(x,{className:"w-4 h-4"})},{id:"location",title:"위치정보 서비스 이용 동의",description:"매칭 서비스 향상을 위한 위치정보 수집에 대한 동의입니다.",required:!1,link:"/terms/location",icon:m.jsx(b,{className:"w-4 h-4"})},{id:"marketing",title:"마케팅 정보 수신 동의",description:"서비스 소식 및 이벤트 정보 수신에 대한 동의입니다.",required:!1,link:"/terms/marketing",icon:m.jsx(b,{className:"w-4 h-4"})}],X=(e,r)=>{const a=r.filter(e=>e.required).filter(r=>!e[r.id]);return a.length>0?`다음 필수 약관에 동의해주세요: ${a.map(e=>e.title).join(", ")}`:null},ee=E({role:O(["DOMESTIC","FACILITY","CAREGIVER"],{required_error:"사용자 유형을 선택해주세요"}),email:A().min(1,"이메일을 입력해주세요").email("올바른 이메일 형식이 아닙니다"),password:A().min(8,"비밀번호는 최소 8자 이상이어야 합니다").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/,"비밀번호는 대소문자, 숫자, 특수문자를 포함해야 합니다"),confirmPassword:A().min(1,"비밀번호 확인을 입력해주세요")}).refine(e=>e.password===e.confirmPassword,{message:"비밀번호가 일치하지 않습니다",path:["confirmPassword"]}),re=E({name:A().min(1,"이름을 입력해주세요").min(2,"이름은 최소 2자 이상이어야 합니다").max(50,"이름은 최대 50자까지 입력 가능합니다"),phoneNumber:A().min(1,"전화번호를 입력해주세요").regex(/^010-\d{4}-\d{4}$/,"올바른 전화번호 형식이 아닙니다"),verificationCode:A().min(6,"인증번호는 6자리입니다").max(6,"인증번호는 6자리입니다")}),ae=E({terms:P(L())}),le=ee.merge(re).merge(ae),te=[{value:"DOMESTIC",label:"가족/보호자",description:"요양 서비스가 필요한 가족을 위해",icon:S,color:"from-pink-500 to-rose-500"},{value:"FACILITY",label:"요양시설",description:"요양 서비스를 제공하는 시설 운영자",icon:I,color:"from-blue-500 to-indigo-500"},{value:"CAREGIVER",label:"간병인",description:"전문적인 간병 서비스를 제공",icon:b,color:"from-green-500 to-emerald-500"}],ie=[{id:1,title:"계정 설정",description:"기본 계정 정보를 입력해주세요"},{id:2,title:"개인 정보",description:"개인 정보 및 전화번호 인증"},{id:3,title:"약관 동의",description:"서비스 이용 약관에 동의해주세요"}],ne=()=>{const e=N(),{register:r,isLoading:a,error:l,clearError:t}=Y(),{isReducedMotion:i}=_(),[n,s]=d.useState(1),[o,h]=d.useState(!1),[u,v]=d.useState(null),[f,b]=d.useState({}),{register:g,handleSubmit:S,watch:I,setValue:E,trigger:A,getValues:O,formState:{errors:P,isValid:L}}=w({resolver:q(le),defaultValues:{role:void 0,email:"",password:"",confirmPassword:"",name:"",phoneNumber:"",verificationCode:"",terms:{}},mode:"onChange"}),B=I("role"),J=I("email"),H=I("password"),W=I("confirmPassword"),ee=I("name"),re=I("phoneNumber"),ae=I("verificationCode"),ne=d.useMemo(()=>{switch(n){case 1:return B&&J&&H&&W&&!P.role&&!P.email&&!P.password&&!P.confirmPassword&&!1!==u;case 2:return ee&&re&&ae&&!P.name&&!P.phoneNumber&&!P.verificationCode&&o;case 3:return!X(f,Q);default:return!1}},[n,B,J,H,W,ee,re,ae,o,f,P,u]),se=Math.round(n/ie.length*100);d.useEffect(()=>{if(l){const e=setTimeout(()=>{t()},5e3);return()=>clearTimeout(e)}},[l,t]);const oe=e=>c(null,null,function*(){try{const r=yield fetch(`/api/auth/check-email?email=${encodeURIComponent(e)}`);return!(yield r.json()).exists}catch(r){return!0}}),ce=e=>c(null,null,function*(){try{if(!(yield fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e})})).ok)throw new Error("인증번호 발송에 실패했습니다");h(!0)}catch(r){throw r}}),de=e=>{b(e),E("terms",e)};return m.jsx(R,{title:"회원가입",subtitle:"새 계정을 만들어 엘더베리를 시작하세요",backLink:"/login",showThemeToggle:!0,testId:"register-page",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[m.jsxs("span",{children:["단계 ",n," / ",ie.length]}),m.jsxs("span",{children:[se,"% 완료"]})]}),m.jsx("div",{className:"w-full h-2 bg-[var(--linear-color-border-subtle)] rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-[var(--linear-color-accent)] transition-all duration-300 ease-out",style:{width:`${se}%`}})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h2",{className:"text-lg font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:ie[n-1].title}),m.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:ie[n-1].description})]})]}),m.jsxs("form",{onSubmit:S(a=>c(null,null,function*(){try{const l=X(f,Q);if(l)throw new Error(l);yield r({email:a.email,password:a.password,confirmPassword:a.confirmPassword,name:a.name,role:a.role,agreedToTerms:f.service||!1,agreedToPrivacy:f.privacy||!1,agreedToMarketing:f.marketing||!1}),e("/login",{state:{message:"회원가입이 완료되었습니다. 로그인해주세요.",email:a.email}})}catch(l){}})),className:"space-y-6",children:[(()=>{var e,r,a,l,t,i;switch(n){case 1:return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)] mb-4",children:"사용자 유형을 선택해주세요 *"}),m.jsx("div",{className:"grid gap-3",children:te.map(e=>m.jsx("button",{type:"button",onClick:()=>{return r=e.value,void E("role",r);var r},className:F("p-4 rounded-[var(--linear-radius-medium)] border-2 transition-all text-left","hover:shadow-[var(--linear-shadow-card)] hover:-translate-y-0.5",B===e.value?"border-[var(--linear-color-accent)] bg-[var(--linear-color-accent)]/5":"border-[var(--linear-color-border-default)] bg-[var(--linear-color-surface-elevated)]"),children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:F("w-10 h-10 rounded-full bg-gradient-to-br flex items-center justify-center text-white",e.color),children:m.jsx(e.icon,{className:"w-5 h-5"})}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:e.label}),m.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:e.description})]}),B===e.value&&m.jsx(V,{className:"w-5 h-5 text-[var(--linear-color-accent)]"})]})},e.value))}),P.role&&m.jsxs("p",{className:"mt-2 text-sm text-[var(--linear-color-error)] flex items-center gap-1",children:[m.jsx(y,{className:"w-4 h-4"}),P.role.message]})]}),m.jsx(D,{label:"이메일 주소",placeholder:"example@email.com",value:J,onChange:e=>E("email",e.target.value),checkDuplicate:oe,errorText:null==(e=P.email)?void 0:e.message,enableDomainSuggestion:!0,required:!0}),m.jsx(M,{label:"비밀번호",placeholder:"비밀번호를 입력하세요",value:H,onChange:e=>E("password",e.target.value),errorText:null==(r=P.password)?void 0:r.message,showStrengthIndicator:!0,showRequirements:!0,required:!0}),m.jsx(z,{label:"비밀번호 확인",placeholder:"비밀번호를 다시 입력하세요",originalPassword:H,value:W,onChange:e=>E("confirmPassword",e.target.value),errorText:null==(a=P.confirmPassword)?void 0:a.message,required:!0})]});case 2:return m.jsxs("div",{className:"space-y-6",children:[m.jsx(G,{label:"이름",placeholder:"홍길동",value:ee,onChange:e=>E("name",e.target.value),errorText:null==(l=P.name)?void 0:l.message,startIcon:m.jsx($,{className:"w-4 h-4"}),autoComplete:"name",required:!0}),m.jsx(U,{label:"전화번호",placeholder:"010-1234-5678",value:re,onChange:e=>E("phoneNumber",e.target.value),errorText:null==(t=P.phoneNumber)?void 0:t.message,showVerificationButton:!0,onSendVerification:ce,verificationSent:o,showCarrier:!0,required:!0}),o&&m.jsx(G,{label:"인증번호",placeholder:"인증번호 6자리를 입력하세요",value:ae,onChange:e=>E("verificationCode",e.target.value),errorText:null==(i=P.verificationCode)?void 0:i.message,startIcon:m.jsx(x,{className:"w-4 h-4"}),maxLength:6,autoComplete:"one-time-code",required:!0})]});case 3:return m.jsx("div",{className:"space-y-6",children:m.jsx(Z,{terms:Q,values:f,onChange:de,showSelectAll:!0,compact:!1})});default:return null}})(),l&&m.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[m.jsx(y,{className:"w-4 h-4 flex-shrink-0"}),l]}),m.jsxs("div",{className:"flex gap-3",children:[n>1&&m.jsxs(K,{type:"button",variant:"outline",size:"lg",onClick:()=>{n>1&&s(n-1)},className:"flex-1",children:[m.jsx(C,{className:"w-4 h-4"}),"이전"]}),n<ie.length?m.jsxs(K,{type:"button",variant:"primary",size:"lg",onClick:()=>c(null,null,function*(){(yield A())&&ne&&n<ie.length&&s(n+1)}),disabled:!ne,className:"flex-1",children:["다음",m.jsx(k,{className:"w-4 h-4"})]}):m.jsxs(K,{type:"submit",variant:"primary",size:"lg",loading:a,disabled:!ne||a,className:"flex-1",children:[m.jsx(p,{className:"w-4 h-4"}),"회원가입 완료"]})]})]}),m.jsx("div",{className:"text-center pt-4 border-t border-[var(--linear-color-border-subtle)]",children:m.jsxs("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:["이미 계정이 있으신가요?"," ",m.jsxs(j,{to:"/login",className:"text-[var(--linear-color-accent)] hover:underline font-[var(--linear-font-weight-medium)] inline-flex items-center gap-1",children:[m.jsx(T,{className:"w-3 h-3"}),"로그인하기"]})]})})]})})};export{ne as RegisterPage,ne as default};

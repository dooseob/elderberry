var e=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(r,a,s)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s,n=(e,r)=>{for(var a in r||(r={}))t.call(r,a)&&i(e,a,r[a]);if(s)for(var a of s(r))l.call(r,a)&&i(e,a,r[a]);return e},o=(e,s)=>r(e,a(s)),c=(e,r,a)=>new Promise((s,t)=>{var l=e=>{try{n(a.next(e))}catch(r){t(r)}},i=e=>{try{n(a.throw(e))}catch(r){t(r)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,r)).next())});import{R as d,j as m,Y as u,L as x,v as h,aG as v,z as p,ak as f,V as g,O as j,o as b,ba as N,C as w,p as y,A as C,e as k,N as S,at as T,_ as P,bh as $,av as I}from"./react-vendor-DxVTcXnD.js";import{t as E,o as O,s as V,e as q,r as A,b as M}from"./utils-D3YFsgXT.js";import{A as L,E as R,P as D,a as G}from"./index-D5N1MR7h.js";import{s as F,I as K,o as z,B,k as Y}from"./board-pages-B7TFhQ6F.js";import{u as _}from"./store-D6HNrl0V.js";import"./vendor-Cb5iQNse.js";import"./state-management-DszUOxv_.js";import"./ui-libs-CJrx2-W2.js";import"./chat-pages-DH9VB2rd.js";const U={SKT:/^010-[2-9]\d{3}-\d{4}$/,KT:/^010-[0-1]\d{3}-\d{4}$/,LG:/^010-(3|6|7|8|9)\d{3}-\d{4}$/,GENERAL:/^010-\d{4}-\d{4}$/},J=e=>{var r=e,{enableAutoFormat:a=!0,showVerificationButton:i=!1,onSendVerification:p,isSendingVerification:f=!1,verificationSent:g=!1,resendCooldown:j=60,showCarrier:b=!1,additionalValidation:N,value:w,onChange:y,className:C}=r,k=((e,r)=>{var a={};for(var i in e)t.call(e,i)&&r.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&s)for(var i of s(e))r.indexOf(i)<0&&l.call(e,i)&&(a[i]=e[i]);return a})(r,["enableAutoFormat","showVerificationButton","onSendVerification","isSendingVerification","verificationSent","resendCooldown","showCarrier","additionalValidation","value","onChange","className"]);const[S,T]=d.useState(w||""),[P,$]=d.useState(null),[I,E]=d.useState(0),O=d.useRef(),V=d.useCallback(e=>{if(!a)return e;const r=e.replace(/\D/g,"");return r.length<=3?r:r.length<=7?`${r.slice(0,3)}-${r.slice(3)}`:r.length<=11?`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7)}`:`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7,11)}`},[a]),q=d.useCallback(e=>{const r=e.replace(/\D/g,"");if(r.length<11)return null;const a=V(r);return U.SKT.test(a)?"SKT":U.KT.test(a)?"KT":U.LG.test(a)?"LG U+":U.GENERAL.test(a)?"알 수 없음":null},[V]),A=d.useCallback(e=>{if(!e)return null;const r=F(e);if(r)return r;if(N){const r=N(e);if(r)return r}return null},[N]);d.useEffect(()=>()=>{O.current&&clearInterval(O.current)},[]);const M=void 0!==w?w.toString():S,L=!A(M)&&M.length>=13;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsx(K,o(n({},k),{type:"tel",value:void 0!==w?w:S,onChange:e=>{const r=e.target.value,a=V(r),s=q(a);T(a),$(s);const t=o(n({},e),{target:o(n({},e.target),{value:a})});null==y||y(t)},validate:A,startIcon:m.jsx(u,{className:"w-4 h-4"}),autoComplete:"tel",placeholder:"010-1234-5678",maxLength:13,className:z(i&&"flex-1",C)})),i&&m.jsx(B,{type:"button",variant:g?"success":"secondary",size:"default",onClick:()=>c(null,null,function*(){if(!p||f||I>0)return;const e=void 0!==w?w.toString():S;if(!A(e))try{yield p(e),E(j);(()=>{O.current=setInterval(()=>{E(e=>e<=1?(O.current&&clearInterval(O.current),0):e-1)},1e3)})()}catch(r){}}),disabled:!L||f||I>0,className:"min-w-[100px] flex-shrink-0","aria-label":"인증번호 발송",children:f?m.jsxs(m.Fragment,{children:[m.jsx(x,{className:"w-4 h-4 animate-spin"}),m.jsx("span",{className:"ml-2",children:"발송중"})]}):g&&0===I?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"w-4 h-4"}),m.jsx("span",{className:"ml-2",children:"재발송"})]}):I>0?m.jsx("span",{className:"text-sm font-mono",children:(R=I,`${Math.floor(R/60)}:${(R%60).toString().padStart(2,"0")}`)}):m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"w-4 h-4"}),m.jsx("span",{className:"ml-2",children:"인증"})]})})]}),(b||g)&&M&&m.jsxs("div",{className:"flex items-center justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[b&&P&&m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(u,{className:"w-3 h-3"}),P]}),g&&m.jsxs("span",{className:"flex items-center gap-1 text-[var(--linear-color-success)]",children:[m.jsx(v,{className:"w-3 h-3"}),"인증번호가 발송되었습니다"]})]})]});var R},W={base:["w-5 h-5 rounded-[var(--linear-radius-small)]","border-2 border-[var(--linear-color-border-default)]","bg-[var(--linear-color-surface-input)]","transition-all duration-[var(--linear-transition-fast)]","flex items-center justify-center cursor-pointer","focus:outline-none focus:ring-2 focus:ring-[var(--linear-color-accent)] focus:ring-opacity-20","hover:border-[var(--linear-color-accent)]"],checked:["bg-[var(--linear-color-accent)] border-[var(--linear-color-accent)]","text-[var(--linear-color-text-on-accent)]"],disabled:["opacity-50 cursor-not-allowed"]},Z=({checked:e,onChange:r,disabled:a=!1,id:s,"aria-label":t})=>m.jsx("div",{role:"checkbox",tabIndex:a?-1:0,"aria-checked":e,"aria-label":t,id:s,className:z(W.base,e&&W.checked,a&&W.disabled),onClick:()=>!a&&r(!e),onKeyDown:s=>{a||" "!==s.key&&"Enter"!==s.key||(s.preventDefault(),r(!e))},children:e&&m.jsx(v,{className:"w-3 h-3",strokeWidth:3})}),H=({terms:e,values:r,onChange:a,error:s,showSelectAll:t=!0,onOpenTerms:l,compact:i=!1,className:c,testId:u="terms-checkbox"})=>{const x=d.useMemo(()=>e.filter(e=>e.required),[e]),h=d.useMemo(()=>e.filter(e=>!e.required),[e]),v=d.useMemo(()=>x.every(e=>!0===r[e.id]),[x,r]),b=d.useMemo(()=>h.every(e=>!0===r[e.id]),[h,r]),N=d.useMemo(()=>v&&b,[v,b]);d.useMemo(()=>Object.values(r).some(Boolean),[r]);const w=e=>e.icon?e.icon:e.title.includes("이용약관")||e.title.includes("서비스")?m.jsx(p,{className:"w-4 h-4"}):e.title.includes("개인정보")||e.title.includes("프라이버시")?m.jsx(f,{className:"w-4 h-4"}):e.title.includes("마케팅")||e.title.includes("광고")?m.jsx(g,{className:"w-4 h-4"}):m.jsx(p,{className:"w-4 h-4"});return m.jsxs("div",{className:z("space-y-4",c),"data-testid":u,children:[t&&m.jsx("div",{className:z("p-4 rounded-[var(--linear-radius-medium)]","bg-[var(--linear-color-surface-elevated)] border border-[var(--linear-color-border-subtle)]"),children:m.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[m.jsx(Z,{id:"select-all-terms",checked:N,onChange:s=>{const t=n({},r);e.forEach(e=>{t[e.id]=s}),a(t)},"aria-label":"모든 약관에 동의"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("span",{className:"text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:"모든 약관에 동의합니다"}),!i&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)] mt-1",children:"선택 항목을 포함하여 모든 약관에 동의합니다"})]})]})}),m.jsx("div",{className:"space-y-3",children:e.map(e=>m.jsx("div",{className:z(i?"py-2":"p-3","rounded-[var(--linear-radius-medium)]","border border-[var(--linear-color-border-subtle)]","hover:bg-[var(--linear-color-surface-elevated)] transition-colors"),children:m.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[m.jsx(Z,{id:`term-${e.id}`,checked:r[e.id]||!1,onChange:s=>((e,s)=>{a(o(n({},r),{[e]:s}))})(e.id,s),"aria-label":`${e.title} 동의`}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"text-[var(--linear-color-text-tertiary)] flex-shrink-0",children:w(e)}),m.jsxs("span",{className:z("text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]","flex items-center gap-1"),children:[e.title,e.required&&m.jsx("span",{className:"text-[var(--linear-color-error)] text-xs","aria-label":"필수",children:"*"})]}),(e.link||l)&&m.jsx("button",{type:"button",onClick:r=>((e,r)=>{r.preventDefault(),r.stopPropagation(),l?l(e.id):e.link&&window.open(e.link,"_blank","noopener,noreferrer")})(e,r),className:"text-[var(--linear-color-text-tertiary)] hover:text-[var(--linear-color-accent)] transition-colors ml-auto","aria-label":`${e.title} 내용 보기`,children:m.jsx(j,{className:"w-3 h-3"})})]}),!i&&e.description&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)] leading-relaxed",children:e.description})]})]})},e.id))}),s&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--linear-color-error)]",role:"alert",children:[m.jsx(j,{className:"w-4 h-4 flex-shrink-0"}),s]}),!i&&x.length>0&&m.jsx("p",{className:"text-xs text-[var(--linear-color-text-tertiary)] text-center",children:"* 표시된 항목은 서비스 이용을 위한 필수 동의 사항입니다"})]})},Q=[{id:"service",title:"엘더베리 서비스 이용약관",description:"엘더베리 플랫폼 서비스 이용에 대한 기본 약관입니다.",required:!0,link:"/terms/service",icon:m.jsx(p,{className:"w-4 h-4"})},{id:"privacy",title:"개인정보 수집 및 이용 동의",description:"서비스 제공을 위한 개인정보 처리에 대한 동의입니다.",required:!0,link:"/terms/privacy",icon:m.jsx(f,{className:"w-4 h-4"})},{id:"location",title:"위치정보 서비스 이용 동의",description:"매칭 서비스 향상을 위한 위치정보 수집에 대한 동의입니다.",required:!1,link:"/terms/location",icon:m.jsx(g,{className:"w-4 h-4"})},{id:"marketing",title:"마케팅 정보 수신 동의",description:"서비스 소식 및 이벤트 정보 수신에 대한 동의입니다.",required:!1,link:"/terms/marketing",icon:m.jsx(g,{className:"w-4 h-4"})}],X=(e,r)=>{const a=r.filter(e=>e.required).filter(r=>!e[r.id]);if(a.length>0){return`다음 필수 약관에 동의해주세요: ${a.map(e=>e.title).join(", ")}`}return null},ee=O({role:q(["DOMESTIC","FACILITY","CAREGIVER"],{required_error:"사용자 유형을 선택해주세요"}),email:V().min(1,"이메일을 입력해주세요").email("올바른 이메일 형식이 아닙니다"),password:V().min(8,"비밀번호는 최소 8자 이상이어야 합니다").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/,"비밀번호는 대소문자, 숫자, 특수문자를 포함해야 합니다"),confirmPassword:V().min(1,"비밀번호 확인을 입력해주세요")}).refine(e=>e.password===e.confirmPassword,{message:"비밀번호가 일치하지 않습니다",path:["confirmPassword"]}),re=O({name:V().min(1,"이름을 입력해주세요").min(2,"이름은 최소 2자 이상이어야 합니다").max(50,"이름은 최대 50자까지 입력 가능합니다"),phoneNumber:V().min(1,"전화번호를 입력해주세요").regex(/^010-\d{4}-\d{4}$/,"올바른 전화번호 형식이 아닙니다"),verificationCode:V().min(6,"인증번호는 6자리입니다").max(6,"인증번호는 6자리입니다")}),ae=O({terms:A(M())}),se=ee.merge(re).merge(ae),te=[{value:"DOMESTIC",label:"가족/보호자",description:"요양 서비스가 필요한 가족을 위해",icon:P,color:"from-pink-500 to-rose-500"},{value:"FACILITY",label:"요양시설",description:"요양 서비스를 제공하는 시설 운영자",icon:$,color:"from-blue-500 to-indigo-500"},{value:"CAREGIVER",label:"간병인",description:"전문적인 간병 서비스를 제공",icon:g,color:"from-green-500 to-emerald-500"}],le=[{id:1,title:"계정 설정",description:"기본 계정 정보를 입력해주세요"},{id:2,title:"개인 정보",description:"개인 정보 및 전화번호 인증"},{id:3,title:"약관 동의",description:"서비스 이용 약관에 동의해주세요"}],ie=()=>{const e=b(),{register:r,isLoading:a,error:s,clearError:t}=_(),{isReducedMotion:l}=Y(),[i,n]=d.useState(1),[o,u]=d.useState(!1),[x,h]=d.useState(null),[p,g]=d.useState({}),{register:j,handleSubmit:P,watch:$,setValue:O,trigger:V,getValues:q,formState:{errors:A,isValid:M}}=N({resolver:E(se),defaultValues:{role:void 0,email:"",password:"",confirmPassword:"",name:"",phoneNumber:"",verificationCode:"",terms:{}},mode:"onChange"}),F=$("role"),U=$("email"),W=$("password"),Z=$("confirmPassword"),ee=$("name"),re=$("phoneNumber"),ae=$("verificationCode"),ie=d.useMemo(()=>{switch(i){case 1:return F&&U&&W&&Z&&!A.role&&!A.email&&!A.password&&!A.confirmPassword&&!1!==x;case 2:return ee&&re&&ae&&!A.name&&!A.phoneNumber&&!A.verificationCode&&o;case 3:return!X(p,Q);default:return!1}},[i,F,U,W,Z,ee,re,ae,o,p,A,x]),ne=Math.round(i/le.length*100);d.useEffect(()=>{if(s){const e=setTimeout(()=>{t()},5e3);return()=>clearTimeout(e)}},[s,t]);const oe=e=>c(null,null,function*(){try{const r=yield fetch(`/api/auth/check-email?email=${encodeURIComponent(e)}`);return!(yield r.json()).exists}catch(r){return!0}}),ce=e=>c(null,null,function*(){try{if(!(yield fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e})})).ok)throw new Error("인증번호 발송에 실패했습니다");u(!0)}catch(r){throw r}}),de=e=>{g(e),O("terms",e)};return m.jsx(L,{title:"회원가입",subtitle:"새 계정을 만들어 엘더베리를 시작하세요",backLink:"/login",showThemeToggle:!0,testId:"register-page",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[m.jsxs("span",{children:["단계 ",i," / ",le.length]}),m.jsxs("span",{children:[ne,"% 완료"]})]}),m.jsx("div",{className:"w-full h-2 bg-[var(--linear-color-border-subtle)] rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-[var(--linear-color-accent)] transition-all duration-300 ease-out",style:{width:`${ne}%`}})}),m.jsxs("div",{className:"text-center",children:[m.jsx("h2",{className:"text-lg font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:le[i-1].title}),m.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:le[i-1].description})]})]}),m.jsxs("form",{onSubmit:P(a=>c(null,null,function*(){try{const s=X(p,Q);if(s)throw new Error(s);yield r({email:a.email,password:a.password,confirmPassword:a.confirmPassword,name:a.name,role:a.role,agreedToTerms:p.service||!1,agreedToPrivacy:p.privacy||!1,agreedToMarketing:p.marketing||!1}),e("/login",{state:{message:"회원가입이 완료되었습니다. 로그인해주세요.",email:a.email}})}catch(s){}})),className:"space-y-6",children:[(()=>{var e,r,a,s,t,l;switch(i){case 1:return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)] mb-4",children:"사용자 유형을 선택해주세요 *"}),m.jsx("div",{className:"grid gap-3",children:te.map(e=>m.jsx("button",{type:"button",onClick:()=>{return r=e.value,void O("role",r);var r},className:z("p-4 rounded-[var(--linear-radius-medium)] border-2 transition-all text-left","hover:shadow-[var(--linear-shadow-card)] hover:-translate-y-0.5",F===e.value?"border-[var(--linear-color-accent)] bg-[var(--linear-color-accent)]/5":"border-[var(--linear-color-border-default)] bg-[var(--linear-color-surface-elevated)]"),children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:z("w-10 h-10 rounded-full bg-gradient-to-br flex items-center justify-center text-white",e.color),children:m.jsx(e.icon,{className:"w-5 h-5"})}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:e.label}),m.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:e.description})]}),F===e.value&&m.jsx(I,{className:"w-5 h-5 text-[var(--linear-color-accent)]"})]})},e.value))}),A.role&&m.jsxs("p",{className:"mt-2 text-sm text-[var(--linear-color-error)] flex items-center gap-1",children:[m.jsx(w,{className:"w-4 h-4"}),A.role.message]})]}),m.jsx(R,{label:"이메일 주소",placeholder:"example@email.com",value:U,onChange:e=>O("email",e.target.value),checkDuplicate:oe,errorText:null==(e=A.email)?void 0:e.message,enableDomainSuggestion:!0,required:!0}),m.jsx(D,{label:"비밀번호",placeholder:"비밀번호를 입력하세요",value:W,onChange:e=>O("password",e.target.value),errorText:null==(r=A.password)?void 0:r.message,showStrengthIndicator:!0,showRequirements:!0,required:!0}),m.jsx(G,{label:"비밀번호 확인",placeholder:"비밀번호를 다시 입력하세요",originalPassword:W,value:Z,onChange:e=>O("confirmPassword",e.target.value),errorText:null==(a=A.confirmPassword)?void 0:a.message,required:!0})]});case 2:return m.jsxs("div",{className:"space-y-6",children:[m.jsx(K,{label:"이름",placeholder:"홍길동",value:ee,onChange:e=>O("name",e.target.value),errorText:null==(s=A.name)?void 0:s.message,startIcon:m.jsx(T,{className:"w-4 h-4"}),autoComplete:"name",required:!0}),m.jsx(J,{label:"전화번호",placeholder:"010-1234-5678",value:re,onChange:e=>O("phoneNumber",e.target.value),errorText:null==(t=A.phoneNumber)?void 0:t.message,showVerificationButton:!0,onSendVerification:ce,verificationSent:o,showCarrier:!0,required:!0}),o&&m.jsx(K,{label:"인증번호",placeholder:"인증번호 6자리를 입력하세요",value:ae,onChange:e=>O("verificationCode",e.target.value),errorText:null==(l=A.verificationCode)?void 0:l.message,startIcon:m.jsx(f,{className:"w-4 h-4"}),maxLength:6,autoComplete:"one-time-code",required:!0})]});case 3:return m.jsx("div",{className:"space-y-6",children:m.jsx(H,{terms:Q,values:p,onChange:de,showSelectAll:!0,compact:!1})});default:return null}})(),s&&m.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[m.jsx(w,{className:"w-4 h-4 flex-shrink-0"}),s]}),m.jsxs("div",{className:"flex gap-3",children:[i>1&&m.jsxs(B,{type:"button",variant:"outline",size:"lg",onClick:()=>{i>1&&n(i-1)},className:"flex-1",children:[m.jsx(y,{className:"w-4 h-4"}),"이전"]}),i<le.length?m.jsxs(B,{type:"button",variant:"primary",size:"lg",onClick:()=>c(null,null,function*(){(yield V())&&ie&&i<le.length&&n(i+1)}),disabled:!ie,className:"flex-1",children:["다음",m.jsx(C,{className:"w-4 h-4"})]}):m.jsxs(B,{type:"submit",variant:"primary",size:"lg",loading:a,disabled:!ie||a,className:"flex-1",children:[m.jsx(v,{className:"w-4 h-4"}),"회원가입 완료"]})]})]}),m.jsx("div",{className:"text-center pt-4 border-t border-[var(--linear-color-border-subtle)]",children:m.jsxs("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:["이미 계정이 있으신가요?"," ",m.jsxs(k,{to:"/login",className:"text-[var(--linear-color-accent)] hover:underline font-[var(--linear-font-weight-medium)] inline-flex items-center gap-1",children:[m.jsx(S,{className:"w-3 h-3"}),"로그인하기"]})]})})]})})};export{ie as RegisterPage,ie as default};

var e=(e,a,r)=>new Promise((l,t)=>{var s=e=>{try{o(r.next(e))}catch(a){t(a)}},i=e=>{try{o(r.throw(e))}catch(a){t(a)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,i);o((r=r.apply(e,a)).next())});import{l as a,u as r,R as l,aY as t,j as s,af as i,b as o,H as n,ao as c,aE as d,d as m,q as h,Z as u,C as v,aj as p,m as f}from"./react-vendor-DZ47R_c4.js";import{t as x,o as w,s as g}from"./schema-validation-DYQ-ih4-.js";import{A as b,E as y,P as N,a as C}from"./index-Bb7KOjKe.js";import{B as j,I as P}from"./core-ui-m-tOi1nQ.js";import{a as T}from"./theme-layout-4NlOVd-a.js";import"./vendor-DKWjmJEO.js";import"./state-management-DFZwgI-2.js";import"./form-libs-B03WVRLJ.js";import"./board-pages-DLDogNe8.js";import"./animation-lib-BkUoMHef.js";import"./style-utils-DeQRAeyh.js";import"./http-client-9JY-woyA.js";import"./chat-pages-CfRW3XtP.js";const k=w({email:g().min(1,"이메일을 입력해주세요").email("올바른 이메일 형식이 아닙니다")}),S=w({verificationCode:g().min(6,"인증번호는 6자리입니다").max(6,"인증번호는 6자리입니다"),newPassword:g().min(8,"비밀번호는 최소 8자 이상이어야 합니다").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])/,"비밀번호는 대소문자, 숫자, 특수문자를 포함해야 합니다"),confirmPassword:g().min(1,"비밀번호 확인을 입력해주세요")}).refine(e=>e.newPassword===e.confirmPassword,{message:"비밀번호가 일치하지 않습니다",path:["confirmPassword"]}),I=k.merge(S),q=[{id:1,title:"이메일 확인",description:"가입한 이메일 주소를 입력해주세요",icon:c},{id:2,title:"비밀번호 재설정",description:"인증번호 확인 후 새 비밀번호를 설정하세요",icon:d}],z=()=>{var w,g,k,S;const z=a(),[E]=r(),{isReducedMotion:O}=T(),J=E.get("token"),L=E.get("email"),[R,V]=l.useState(J?2:1),[A,H]=l.useState(!1),[M,Z]=l.useState(null),[$,B]=l.useState(null),[F,Y]=l.useState(!1),[D,G]=l.useState(0),[K,Q]=l.useState(null),U=l.useRef(),{register:W,handleSubmit:X,watch:_,setValue:ee,trigger:ae,formState:{errors:re,isValid:le}}=t({resolver:x(I),defaultValues:{email:L||"",verificationCode:"",newPassword:"",confirmPassword:""},mode:"onChange"}),te=_("email"),se=_("verificationCode"),ie=_("newPassword"),oe=_("confirmPassword");l.useEffect(()=>{J&&L&&ne(J,L)},[J,L]),l.useEffect(()=>(D>0&&(U.current=setInterval(()=>{G(e=>e<=1?(U.current&&clearInterval(U.current),0):e-1)},1e3)),()=>{U.current&&clearInterval(U.current)}),[D]),l.useEffect(()=>{if(M){const e=setTimeout(()=>{Z(null)},5e3);return()=>clearTimeout(e)}},[M]);const ne=(a,r)=>e(null,null,function*(){try{H(!0);const e=yield fetch("/api/auth/validate-reset-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,email:r})}),l=yield e.json();e.ok&&l.valid?(Q(!0),ee("email",r)):(Q(!1),Z("유효하지 않거나 만료된 재설정 링크입니다."),V(1))}catch(e){Q(!1),Z("링크 검증 중 오류가 발생했습니다."),V(1)}finally{H(!1)}}),ce=a=>e(null,null,function*(){try{H(!0),Z(null);const e=yield fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})}),r=yield e.json();if(!e.ok)throw new Error(r.message||"이메일 전송에 실패했습니다.");Y(!0),B("비밀번호 재설정 링크가 이메일로 전송되었습니다."),V(2)}catch(e){Z(e instanceof Error?e.message:"이메일 전송에 실패했습니다.")}finally{H(!1)}}),de=Math.round(R/q.length*100);return $&&2===R&&!M?s.jsx(b,{title:"비밀번호 변경 완료",subtitle:"비밀번호가 성공적으로 변경되었습니다",showHomeLink:!0,showThemeToggle:!0,testId:"password-reset-success",children:s.jsxs("div",{className:"text-center space-y-6",children:[s.jsx("div",{className:"w-16 h-16 mx-auto bg-[var(--linear-color-success)] rounded-full flex items-center justify-center",children:s.jsx(i,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h2",{className:"text-xl font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:"변경 완료!"}),s.jsxs("p",{className:"text-[var(--linear-color-text-secondary)]",children:["비밀번호가 성공적으로 변경되었습니다.",s.jsx("br",{}),"잠시 후 로그인 페이지로 이동됩니다."]})]}),s.jsx("div",{className:"w-8 h-8 mx-auto animate-spin rounded-full border-2 border-[var(--linear-color-accent)] border-t-transparent"}),s.jsx(j,{variant:"primary",size:"lg",asChild:!0,className:"w-full",children:s.jsxs(o,{to:"/login",children:[s.jsx(n,{className:"w-4 h-4"}),"지금 로그인하기"]})})]})}):s.jsx(b,{title:"비밀번호 찾기",subtitle:"등록된 이메일로 비밀번호를 재설정하세요",backLink:"/login",showThemeToggle:!0,testId:"forgot-password-page",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between text-xs text-[var(--linear-color-text-secondary)]",children:[s.jsxs("span",{children:["단계 ",R," / ",q.length]}),s.jsxs("span",{children:[de,"% 완료"]})]}),s.jsx("div",{className:"w-full h-2 bg-[var(--linear-color-border-subtle)] rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-[var(--linear-color-accent)] transition-all duration-300 ease-out",style:{width:`${de}%`}})}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-[var(--linear-color-accent)] rounded-full flex items-center justify-center",children:l.createElement(q[R-1].icon,{className:"w-6 h-6 text-white"})}),s.jsx("h2",{className:"text-lg font-[var(--linear-font-weight-semibold)] text-[var(--linear-color-text-primary)]",children:q[R-1].title}),s.jsx("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:q[R-1].description})]})]}),1===R&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(y,{label:"이메일 주소",placeholder:"가입할 때 사용한 이메일을 입력하세요",value:te,onChange:e=>ee("email",e.target.value),errorText:null==(w=re.email)?void 0:w.message,autoComplete:"email",autoFocus:!0,required:!0}),M&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[s.jsx(m,{className:"w-4 h-4 flex-shrink-0"}),M]}),$&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-success-bg)] text-[var(--linear-color-success)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[s.jsx(i,{className:"w-4 h-4 flex-shrink-0"}),$]}),s.jsxs(j,{type:"button",variant:"primary",size:"lg",onClick:()=>e(null,null,function*(){(yield ae(["email"]))&&(yield ce(te))}),loading:A,disabled:!te||!!re.email||A,className:"w-full",children:[s.jsx(h,{className:"w-4 h-4"}),"재설정 링크 받기"]})]}),2===R&&s.jsxs("form",{onSubmit:X(a=>e(null,null,function*(){yield(a=>e(null,null,function*(){try{H(!0),Z(null);const e=yield fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,verificationCode:a.verificationCode,newPassword:a.newPassword,token:J})}),r=yield e.json();if(!e.ok)throw new Error(r.message||"비밀번호 재설정에 실패했습니다.");B("비밀번호가 성공적으로 변경되었습니다."),setTimeout(()=>{z("/login",{state:{message:"비밀번호가 변경되었습니다. 새 비밀번호로 로그인해주세요.",email:a.email}})},3e3)}catch(e){Z(e instanceof Error?e.message:"비밀번호 재설정에 실패했습니다.")}finally{H(!1)}}))(a)})),className:"space-y-6",children:[s.jsx("div",{className:"p-4 bg-[var(--linear-color-surface-elevated)] rounded-[var(--linear-radius-medium)] border border-[var(--linear-color-border-subtle)]",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(c,{className:"w-5 h-5 text-[var(--linear-color-accent)]"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-[var(--linear-font-weight-medium)] text-[var(--linear-color-text-primary)]",children:te}),s.jsx("p",{className:"text-xs text-[var(--linear-color-text-secondary)]",children:"위 이메일로 인증번호가 전송되었습니다"})]}),0===D&&s.jsxs(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>e(null,null,function*(){D>0||(yield ce(te),G(60))}),disabled:A,children:[s.jsx(u,{className:"w-3 h-3"}),"재발송"]}),D>0&&s.jsxs("div",{className:"flex items-center gap-1 text-xs text-[var(--linear-color-text-tertiary)]",children:[s.jsx(v,{className:"w-3 h-3"}),D,"초"]})]})}),s.jsx(P,{label:"인증번호",placeholder:"이메일로 받은 6자리 인증번호",value:se,onChange:e=>ee("verificationCode",e.target.value),errorText:null==(g=re.verificationCode)?void 0:g.message,startIcon:s.jsx(p,{className:"w-4 h-4"}),maxLength:6,autoComplete:"one-time-code",required:!0}),s.jsx(N,{label:"새 비밀번호",placeholder:"새로운 비밀번호를 입력하세요",value:ie,onChange:e=>ee("newPassword",e.target.value),errorText:null==(k=re.newPassword)?void 0:k.message,showStrengthIndicator:!0,showRequirements:!0,autoComplete:"new-password",required:!0}),s.jsx(C,{label:"비밀번호 확인",placeholder:"새 비밀번호를 다시 입력하세요",originalPassword:ie,value:oe,onChange:e=>ee("confirmPassword",e.target.value),errorText:null==(S=re.confirmPassword)?void 0:S.message,autoComplete:"new-password",required:!0}),M&&s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-[var(--linear-color-error-bg)] text-[var(--linear-color-error)] rounded-[var(--linear-radius-medium)] text-sm",role:"alert",children:[s.jsx(m,{className:"w-4 h-4 flex-shrink-0"}),M]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs(j,{type:"button",variant:"outline",size:"lg",onClick:()=>V(1),className:"flex-1",children:[s.jsx(f,{className:"w-4 h-4"}),"이전"]}),s.jsxs(j,{type:"submit",variant:"primary",size:"lg",loading:A,disabled:!se||!ie||!oe||!!re.verificationCode||!!re.newPassword||!!re.confirmPassword||A,className:"flex-1",children:[s.jsx(d,{className:"w-4 h-4"}),"비밀번호 변경"]})]})]}),s.jsx("div",{className:"text-center pt-4 border-t border-[var(--linear-color-border-subtle)]",children:s.jsxs("p",{className:"text-sm text-[var(--linear-color-text-secondary)]",children:["비밀번호가 기억나셨나요?"," ",s.jsxs(o,{to:"/login",className:"text-[var(--linear-color-accent)] hover:underline font-[var(--linear-font-weight-medium)] inline-flex items-center gap-1",children:[s.jsx(n,{className:"w-3 h-3"}),"로그인하기"]})]})})]})})};export{z as ForgotPasswordPage,z as default};
